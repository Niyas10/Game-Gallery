<%- include('../partials/head.ejs') %>
<style>
.btn :hover {
        background-color: #ff2f2f !important;
    }
</style>
<body>

    <div class="main-wrapper">
        <header class="header-area transparent-bar section-padding-1">
            <div class="container-fluid">
                <div class="header-large-device">
                    <div class="header-top header-top-ptb-1 border-bottom-1">
                        <div class="row">
                            <div class="col-xl-4 col-lg-5">
                                <div class="header-offer-wrap">
                                    <p><i class="icon-paper-plane"></i> FREE SHIPPING world wide for all orders over <span>$199</span></p>
                                </div>
                            </div>
                            <div class="col-xl-8 col-lg-7">
                                <div class="header-top-right">
                                    <div class="same-style-wrap">
                                        <!-- <div class="same-style same-style-border track-order">
                                            <a href="order-tracking.html">Track Your Order</a>
                                        </div> -->
                                        <!-- <div class="same-style same-style-border language-wrap">
                                            <a class="language-dropdown-active" href="#">English <i class="icon-arrow-down"></i></a>
                                            <div class="language-dropdown">
                                                <ul>
                                                    <li><a href="#">English</a></li>
                                                    <li><a href="#">French</a></li>
                                                    <li><a href="#">German</a></li>
                                                    <li><a href="#">Spanish</a></li>
                                                </ul>
                                            </div>
                                        </div> -->
                                        <div class="same-style same-style-border currency-wrap">
                                            <!-- <a class=" " href="/signup" >Sign Up</a> -->
                                            <% 
                                            if( isLoggedIn ){
                                                %>
                                                <a href="/logout">Sign Out</a>
                                                <%
                                            }else{
                                                %>
                                                <a href="/signup">Sign up</a>
                                                <%
                                            }
                                            %>
                                     
                                        </div>
                                    </div>
                                    <div class="social-style-1 social-style-1-mrg">
                                        <a href="#"><i class="icon-social-twitter"></i></a>
                                        <a href="#"><i class="icon-social-facebook"></i></a>
                                        <a href="#"><i class="icon-social-instagram"></i></a>
                                        <a href="#"><i class="icon-social-youtube"></i></a>
                                        <a href="#"><i class="icon-social-pinterest"></i></a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="header-bottom">
                        <div class="row align-items-center">
                            <div class="col-xl-2 col-lg-2">
                                <div class="logo">
                                    <a href="index.html"><span style="color: red;
                                        font-size: 34px;
                                        font-weight: 500;">Game</span> <span style="font-size: 20px ;color: black;
                                        font-weight: 400;">Gallery</span></a>
                                </div>
                            </div>
                            <div class="col-xl-8 col-lg-7">
                                <div class="main-menu main-menu-padding-1 main-menu-lh-1">
                                    <nav>
                                        <ul style="text-align: center;">
                                            <li><a href="/home">HOME </a>
                                                <!-- <ul class="sub-menu-style">
                                                    <li><a href="index.html">Home version 1 </a></li>
                                                    <li><a href="index-2.html">Home version 2</a></li>
                                                    <li><a href="index-3.html">Home version 3</a></li>
                                                    <li><a href="index-4.html">Home version 4</a></li>
                                                    <li><a href="index-5.html">Home version 5</a></li>
                                                    <li><a href="index-6.html">Home version 6</a></li>
                                                    <li><a href="index-7.html">Home version 7</a></li>
                                                    <li><a href="index-8.html">Home version 8</a></li>
                                                    <li><a href="index-9.html">Home version 9</a></li>
                                                    <li><a href="index-10.html">Home version 10</a></li>
                                                </ul> -->
                                            </li>
                                            <li><a href="/shop">SHOP </a>
                                                <!-- <ul class="mega-menu-style mega-menu-mrg-1">
                                                    <li>
                                                        <ul>
                                                            <li>
                                                                <a class="dropdown-title" href="#">Shop Layout</a>
                                                                <ul>
                                                                    <li><a href="shop.html">standard style</a></li>
                                                                    <li><a href="shop-list.html">shop list style</a></li>
                                                                    <li><a href="shop-fullwide.html">shop fullwide</a></li>
                                                                    <li><a href="shop-no-sidebar.html">grid no sidebar</a></li>
                                                                    <li><a href="shop-list-no-sidebar.html">list no sidebar</a></li>
                                                                    <li><a href="shop-right-sidebar.html">shop right sidebar</a></li>
                                                                    <li><a href="store-location.html">store location</a></li>
                                                                </ul>
                                                            </li>
                                                            <li>
                                                                <a class="dropdown-title" href="#">Products Layout</a>
                                                                <ul>
                                                                    <li><a href="product-details.html">tab style 1</a></li>
                                                                    <li><a href="product-details-2.html">tab style 2</a></li>
                                                                    <li><a href="product-details-sticky.html">sticky style</a></li>
                                                                    <li><a href="product-details-gallery.html">gallery style </a></li>
                                                                    <li><a href="product-details-affiliate.html">affiliate style</a></li>
                                                                    <li><a href="product-details-group.html">group style</a></li>
                                                                    <li><a href="product-details-fixed-img.html">fixed image style </a></li>
                                                                </ul>
                                                            </li>
                                                            <li>
                                                                <a href="shop.html"><img src="assets/images/banner/banner-12.png" alt=""></a>
                                                            </li>
                                                        </ul>
                                                    </li>
                                                </ul> -->
                                            </li>
                                            <li><a href="#">PAGES </a>
                                                <!-- <ul class="sub-menu-style">
                                                    <li><a href="about-us.html">about us </a></li>
                                                    <li><a href="cart.html">cart page</a></li>
                                                    <li><a href="checkout.html">checkout </a></li>
                                                    <li><a href="my-account.html">my account</a></li>
                                                    <li><a href="wishlist.html">wishlist </a></li>
                                                    <li><a href="compare.html">compare </a></li>
                                                    <li><a href="contact.html">contact us </a></li>
                                                    <li><a href="order-tracking.html">order tracking</a></li>
                                                    <li><a href="login-register.html">login / register </a></li>
                                                </ul> -->
                                            </li>
                                            <li><a href="blog.html">BLOG </a>
                                                <!-- <ul class="sub-menu-style">
                                                    <li><a href="blog.html">blog standard </a></li>
                                                    <li><a href="blog-no-sidebar.html">blog no sidebar </a></li>
                                                    <li><a href="blog-right-sidebar.html">blog right sidebar</a></li>
                                                    <li><a href="blog-details.html">blog details</a></li>
                                                </ul> -->
                                            </li>
                                            <li><a href="contact.html">CONTACT </a></li>
                                        </ul>
                                    </nav>
                                </div>
                            </div>
                            <div class="col-xl-2 col-lg-3">
                                <div class="header-action header-action-flex header-action-mrg-right">
                                    <div class="same-style-2 header-search-1">
                                        <a class="search-toggle" href="#">
                                            <i class="icon-magnifier s-open"></i>
                                            <i class="icon_close s-close"></i>
                                        </a>
                                        <div class="search-wrap-1">
                                            <form action="#">
                                                <input placeholder="Search products…" type="text">
                                                <button class="button-search"><i class="icon-magnifier"></i></button>
                                            </form>
                                        </div>
                                    </div>
                                    <div class="same-style-2">
                                        <a href="/profile"><i class="icon-user"></i></a>
                                    </div>
                                    <div class="same-style-2">
                                     
                                        <a href="wishlist.html"> <i class="icon-heart"></i> <% if(locals.isLoggedIn && wishCount>0){ %>
                                            <span class="pro-count red">
                                                <%=wishCount %>
                                            </span>
                                            <% } %></a>
                                    </div>
                                    <div class="same-style-2 header-cart">
                                        <a href="/shoppingCart">
                                            <i class="icon-basket-loaded"></i>
                                        <% if(locals.isLoggedIn && cartCount>0){ %>
                                            <span class="pro-count red">
                                            <%=cartCount %>
                                        </span>
                                        <% } %>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="header-small-device small-device-ptb-1">
                    <div class="row align-items-center">
                        <div class="col-5">
                            <div class="mobile-logo">
                                <a href="index.html"><span style="color: red;
                                        font-size: 34px;
                                        font-weight: 500;">Game</span> <span style="font-size: 20px ;color: black;
                                        font-weight: 400;">Gallery</span></a>
                            </div>
                        </div>
                        <div class="col-7">
                            <div class="header-action header-action-flex">
                                <div class="same-style-2">
                                    <a href="login-register.html"><i class="icon-user"></i></a>
                                </div>
                                <div class="same-style-2">
                                    <a href="wishlist.html"> <i class="icon-heart"></i> <% if(locals.isLoggedIn && wishCount>0){ %>
                                            <span class="pro-count red">
                                                <%=wishCount %>
                                            </span>
                                            <% } %></a>
                                </div>
                                <div class="same-style-2 header-cart">
                                    <a class="cart-active" href="#">
                                        <i class="icon-basket-loaded"></i>
                                        <% if(locals.isLoggedIn && cartCount>0){ %>
                                            <span class="pro-count red">
                                            <%=cartCount %>
                                        </span>
                                        <% } %>
                                    </a>
                                </div>
                                <div class="same-style-2 main-menu-icon">
                                    <a class="mobile-header-button-active" href="#"><i class="icon-menu"></i> </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>


        <!-- Mobile menu start -->
        <div class="mobile-header-active mobile-header-wrapper-style">
            <div class="clickalbe-sidebar-wrap">
                <a class="sidebar-close"><i class="icon_close"></i></a>
                <div class="mobile-header-content-area">
                    <div class="header-offer-wrap mobile-header-padding-border-4">
                        <p><i class="icon-paper-plane"></i> FREE SHIPPING world wide for all orders over <span>$199</span></p>
                    </div>
                    <div class="mobile-search mobile-header-padding-border-1">
                        <form class="search-form" action="#">
                            <input type="text" placeholder="Search here…">
                            <button class="button-search"><i class="icon-magnifier"></i></button>
                        </form>
                    </div>
                    <div class="mobile-menu-wrap mobile-header-padding-border-2">
                        <!-- mobile menu start -->
                        <nav>
                            <ul class="mobile-menu">
                                <li class="menu-item-has-children"><a href="index.html">Home</a>
                                    <ul class="dropdown">
                                        <li><a href="index.html">Home version 1 </a></li>
                                        <li><a href="index-2.html">Home version 2</a></li>
                                        <li><a href="index-3.html">Home version 3</a></li>
                                        <li><a href="index-4.html">Home version 4</a></li>
                                        <li><a href="index-5.html">Home version 5</a></li>
                                        <li><a href="index-6.html">Home version 6</a></li>
                                        <li><a href="index-7.html">Home version 7</a></li>
                                        <li><a href="index-8.html">Home version 8</a></li>
                                        <li><a href="index-9.html">Home version 9</a></li>
                                        <li><a href="index-10.html">Home version 10</a></li>
                                    </ul>
                                </li>
                                <li class="menu-item-has-children "><a href="#">shop</a>
                                    <ul class="dropdown">
                                        <li class="menu-item-has-children"><a href="#">shop layout</a>
                                            <ul class="dropdown">
                                                <li><a href="shop.html">standard style</a></li>
                                                <li><a href="shop-list.html">shop list style</a></li>
                                                <li><a href="shop-fullwide.html">shop fullwide</a></li>
                                                <li><a href="shop-no-sidebar.html">grid no sidebar</a></li>
                                                <li><a href="shop-list-no-sidebar.html">list no sidebar</a></li>
                                                <li><a href="shop-right-sidebar.html">shop right sidebar</a></li>
                                                <li><a href="store-location.html">store location</a></li>
                                            </ul>
                                        </li>
                                        <li class="menu-item-has-children"><a href="#">Products Layout</a>
                                            <ul class="dropdown">
                                                <li><a href="product-details.html">tab style 1</a></li>
                                                <li><a href="product-details-2.html">tab style 2</a></li>
                                                <li><a href="product-details-sticky.html">sticky style</a></li>
                                                <li><a href="product-details-gallery.html">gallery style </a></li>
                                                <li><a href="product-details-affiliate.html">affiliate style</a></li>
                                                <li><a href="product-details-group.html">group style</a></li>
                                                <li><a href="product-details-fixed-img.html">fixed image style </a></li>
                                            </ul>
                                        </li>
                                    </ul>
                                </li>
                                <li class="menu-item-has-children"><a href="#">Pages</a>
                                    <ul class="dropdown">
                                        <li><a href="about-us.html">about us </a></li>
                                        <li><a href="cart.html">cart page</a></li>
                                        <li><a href="checkout.html">checkout </a></li>
                                        <li><a href="my-account.html">my account</a></li>
                                        <li><a href="wishlist.html">wishlist </a></li>
                                        <li><a href="compare.html">compare </a></li>
                                        <li><a href="contact.html">contact us </a></li>
                                        <li><a href="order-tracking.html">order tracking</a></li>
                                        <li><a href="login-register.html">login / register </a></li>
                                    </ul>
                                </li>
                                <li class="menu-item-has-children "><a href="#">Blog</a>
                                    <ul class="dropdown">
                                        <li><a href="blog.html">blog standard </a></li>
                                        <li><a href="blog-no-sidebar.html">blog no sidebar </a></li>
                                        <li><a href="blog-right-sidebar.html">blog right sidebar</a></li>
                                        <li><a href="blog-details.html">blog details</a></li>
                                    </ul>
                                </li>
                                <li><a href="contact.html">Contact us</a></li>
                            </ul>
                        </nav>
                        <!-- mobile menu end -->
                    </div>
                    <div class="mobile-header-info-wrap mobile-header-padding-border-3">
                        <div class="single-mobile-header-info">
                            <a href="order-tracking.html"><i class="lastudioicon-pin-3-2"></i> Track Your Order </a>
                        </div>
                        <div class="single-mobile-header-info">
                            <a class="mobile-language-active" href="#">Language <span><i class="icon-arrow-down"></i></span></a>
                            <div class="lang-curr-dropdown lang-dropdown-active">
                                <ul>
                                    <li><a href="#">English</a></li>
                                    <li><a href="#">French</a></li>
                                    <li><a href="#">German</a></li>
                                    <li><a href="#">Spanish</a></li>
                                </ul>
                            </div>
                        </div>
                        <div class="single-mobile-header-info">
                            <a class="mobile-currency-active" href="#">Currency <span><i class="icon-arrow-down"></i></span></a>
                            <div class="lang-curr-dropdown curr-dropdown-active">
                                <ul>
                                    <li><a href="#">USD</a></li>
                                    <li><a href="#">EUR</a></li>
                                    <li><a href="#">Real</a></li>
                                    <li><a href="#">BDT</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="mobile-contact-info mobile-header-padding-border-4">
                        <ul>
                            <li><i class="icon-phone "></i> (+612) 2531 5600</li>
                            <li><i class="icon-envelope-open "></i> norda@domain.com</li>
                            <li><i class="icon-home"></i> PO Box 1622 Colins Street West Australia</li>
                        </ul>
                    </div>
                    <div class="mobile-social-icon">
                        <a class="facebook" href="#"><i class="icon-social-facebook"></i></a>
                        <a class="twitter" href="#"><i class="icon-social-twitter"></i></a>
                        <a class="pinterest" href="#"><i class="icon-social-pinterest"></i></a>
                        <a class="instagram" href="#"><i class="icon-social-instagram"></i></a>
                    </div>
                </div>
            </div>
        </div>
        <!-- mini cart start -->
        <div class="sidebar-cart-active">
            <div class="sidebar-cart-all">
                <a class="cart-close" href="#"><i class="icon_close"></i></a>
                <div class="cart-content">
                    <h3>Shopping Cart</h3>
                    <ul>
                        <li class="single-product-cart">
                            <div class="cart-img">
                                <a href="#"><img src="assets/images/cart/cart-1.jpg" alt=""></a>
                            </div>
                            <div class="cart-title">
                                <h4><a href="#">Simple Black T-Shirt</a></h4>
                                <span> 1 × $49.00	</span>
                            </div>
                            <div class="cart-delete">
                                <a href="#">×</a>
                            </div>
                        </li>
                        <li class="single-product-cart">
                            <div class="cart-img">
                                <a href="#"><img src="assets/images/cart/cart-2.jpg" alt=""></a>
                            </div>
                            <div class="cart-title">
                                <h4><a href="#">Norda Backpack</a></h4>
                                <span> 1 × $49.00	</span>
                            </div>
                            <div class="cart-delete">
                                <a href="#">×</a>
                            </div>
                        </li>
                    </ul>
                    <div class="cart-total">
                        <h4>Subtotal: <span>$170.00</span></h4>
                    </div>
                    <div class="cart-checkout-btn">
                        <a class="btn-hover cart-btn-style" href="cart.html">view cart</a>
                        <a class="no-mrg btn-hover cart-btn-style" href="checkout.html">checkout</a>
                    </div>
                </div>
            </div>
         </div>
 



         <div class="checkout-main-area pt-120 pb-120" style="    padding-top: 170px;">
            <div class="container">
                <div class="customer-zone mb-20">
                   
                    <div class="checkout-login-info">
                       
                        <form action="#">
                            <div class="row">
                                <div class="col-lg-6 col-md-6">
                                    <div class="sin-checkout-login">
                                        <label>Username or email address <span>*</span></label>
                                        <input type="text" name="user-name">
                                    </div>
                                </div>
                                <div class="col-lg-6 col-md-6">
                                    <div class="sin-checkout-login">
                                        <label>Passwords <span>*</span></label>
                                        <input type="password" name="user-password">
                                    </div>
                                </div>
                            </div>
                            <div class="button-remember-wrap">
                                <button class="button" type="submit">Login</button>
                                <div class="checkout-login-toggle-btn">
                                    <input type="checkbox">
                                    <label>Remember me</label>
                                </div>
                            </div>
                            <div class="lost-password">
                                <a href="#">Lost your password?</a>
                            </div>
                        </form>
                        <div class="checkout-login-social">
                            <span>Login with:</span>
                            <ul>
                                <li><a href="#">Facebook</a></li>
                                <li><a href="#">Twitter</a></li>
                                <li><a href="#">Google</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
             


                <div class="checkout-wrap pt-30">
                    <div class="row">
                        <div class="col-lg-7">
                            <div class="billing-info-wrap mr-50">
                                <h3>Billing Details</h3>
                                
                                <div class="row">
                                    <div class="col-lg-12 col-md-6" style="padding-right: 0px;">
                                        <div class="discount-code-wrapper">
                                            <div class="title-wrap">
                                                <h4 class="cart-bottom-title section-bg-gray">Use Coupon Code</h4>
                                            </div>
                                            <div class="discount-code">
                                                <p>Enter your coupon code if you have one.</p>
                                                <form  action="" id="applyCoupon" method="" class="">
                                                    <input type="text" name="code"   placeholder="Enter Coupon code">
                                                    <button class="cart-btn-2" type="submit">Apply Coupon</button>
                                                </form>
                                                <div style="position: relative; top: 10px;">
                                                    <a class="text-dark text-decoration-underline" style="cursor: pointer;"
                                                        data-bs-toggle="modal" data-bs-target="#exampleModal">Explore coupons</a>
                                                    <h6 class="text-danger mt-1" id="coupon-error"></h6>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                        
                                    <form action="/shoppingCart/placeOrder" method="post" id="checkout-form">
                                       
                                        <% 
                                        if(userAddress && userAddress.addresses.length >= 5){
                                            %>
                                            <div class="row d-flex justify-content-end mx-3">
                                                <p>You can add max of 5 Addresses</p>
                                            </div>
                                            <%
                                        }else{
                                            %>
                                            <div class="row d-flex justify-content-end mx-3" >
                                                <a href="/profile/addAddress?returnPage=checkout" class="btn btn-dark   newButton"  style="    position: relative;    background-color: #000000;
    border: medium none;
    color: #ffffff;
    cursor: pointer;
    font-size: 14px;
    font-weight: 600;
    padding: 12px 40px 13px;
   
     margin-top: 30px;
     margin-bottom: 30px;
    left: 17px;
    
" >Add Address</a>
                                            </div>
                                            <%
                                        }
                                        if(userAddress){
                                            
                                            userAddress.addresses.forEach((address) => {
                                                %>
                                                <div class="card mb-3">
                                                    <div class="card-body d-flex">
                                                        <div class="mx-3">
                                                            <input type="radio" name="address" id="<%= address._id %>" value="<%= address._id %>" checked>
                                                        </div>
                                                        <div>
                                                            <h5 class="card-title" style="font-weight: 500;"><%= address.userName %> <%= address.mobile %></h5>
                                                            <p style="font-weight: 500;"><%= address.email %></p>
                                                            <p class="card-text" style="font-weight: 500;"> 
                                                                <%= 
                                                                address.town+' '+address.state+" "+address.country+" "+address.zip+' \n '+address.address
                                                                %>
                                                            </p>
                                                            <!-- <a href="#" class="btn btn-primary">Edit</a> -->
                                                            <a href="/profile/editAddress/<%= address._id %>?returnPage=checkout">
                                                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-pencil-square" viewBox="0 0 16 16">
                                                                    <path d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"/>
                                                                    <path fill-rule="evenodd" d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5v11z"/>
                                                                </svg>
                                                            </a>
                                                        </div>
                                                    </div>
                                                </div>
                                                <%  
                                            })
                                        }
            
                                     
                                        %>
                                  
                                    <!-- <div class="col-lg-6 col-md-6">
                                        <div class="billing-info mb-20">
                                            <label>First Name <abbr class="required" title="required">*</abbr></label>
                                            <input type="text">
                                        </div>
                                    </div> -->
                                    <!-- <div class="col-lg-6 col-md-6">
                                        <div class="billing-info mb-20">
                                            <label>Last Name <abbr class="required" title="required">*</abbr></label>
                                            <input type="text">
                                        </div>
                                    </div> -->
                                    <!-- <div class="col-lg-12">
                                        <div class="billing-info mb-20">
                                            <label>Company Name <abbr class="required" title="required">*</abbr></label>
                                            <input type="text">
                                        </div>
                                    </div>
                                    <div class="col-lg-12">
                                        <div class="billing-select mb-20">
                                            <label>Country <abbr class="required" title="required">*</abbr></label>
                                            <select>
                                                <option>Select a country</option>
                                                <option>Azerbaijan</option>
                                                <option>Bahamas</option>
                                                <option>Bahrain</option>
                                                <option>Bangladesh</option>
                                                <option>Barbados</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-lg-12">
                                        <div class="billing-info mb-20">
                                            <label>Street Address <abbr class="required" title="required">*</abbr></label>
                                            <input class="billing-address" placeholder="House number and street name" type="text">
                                            <input placeholder="Apartment, suite, unit etc." type="text">
                                        </div>
                                    </div>
                                    <div class="col-lg-12">
                                        <div class="billing-info mb-20">
                                            <label>Town / City <abbr class="required" title="required">*</abbr></label>
                                            <input type="text">
                                        </div>
                                    </div>
                                    <div class="col-lg-12 col-md-12">
                                        <div class="billing-info mb-20">
                                            <label>State / County <abbr class="required" title="required">*</abbr></label>
                                            <input type="text">
                                        </div>
                                    </div>
                                    <div class="col-lg-12 col-md-12">
                                        <div class="billing-info mb-20">
                                            <label>Postcode / ZIP <abbr class="required" title="required">*</abbr></label>
                                            <input type="text">
                                        </div>
                                    </div>
                                    <div class="col-lg-12 col-md-12">
                                        <div class="billing-info mb-20">
                                            <label>Phone <abbr class="required" title="required">*</abbr></label>
                                            <input type="text">
                                        </div>
                                    </div>
                                    <div class="col-lg-12 col-md-12">
                                        <div class="billing-info mb-20">
                                            <label>Email Address <abbr class="required" title="required">*</abbr></label>
                                            <input type="text">
                                        </div> -->
                                    <!-- </div> -->
                                </div>
                                <!-- <div class="checkout-account mb-25">
                                    <input class="checkout-toggle2" type="checkbox">
                                    <span>Create an account?</span>
                                </div> -->
                                <!-- <div class="checkout-account-toggle open-toggle2 mb-30">
                                    <label>Email Address</label>
                                    <input placeholder="Password" type="password">
                                </div>
                                <div class="checkout-account mt-25">
                                    <input class="checkout-toggle" type="checkbox">
                                    <span>Ship to a different address?</span>
                                </div> -->
                                <!-- <div class="different-address open-toggle mt-30">
                                    <div class="row">
                                        <div class="col-lg-6 col-md-6">
                                            <div class="billing-info mb-20">
                                                <label>First Name</label>
                                                <input type="text">
                                            </div>
                                        </div>
                                        <div class="col-lg-6 col-md-6">
                                            <div class="billing-info mb-20">
                                                <label>Last Name</label>
                                                <input type="text">
                                            </div>
                                        </div>
                                        <div class="col-lg-12">
                                            <div class="billing-info mb-20">
                                                <label>Company Name</label>
                                                <input type="text">
                                            </div>
                                        </div>
                                        <div class="col-lg-12">
                                            <div class="billing-select mb-20">
                                                <label>Country</label>
                                                <select>
                                                    <option>Select a country</option>
                                                    <option>Azerbaijan</option>
                                                    <option>Bahamas</option>
                                                    <option>Bahrain</option>
                                                    <option>Bangladesh</option>
                                                    <option>Barbados</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-lg-12">
                                            <div class="billing-info mb-20">
                                                <label>Street Address</label>
                                                <input class="billing-address" placeholder="House number and street name" type="text">
                                                <input placeholder="Apartment, suite, unit etc." type="text">
                                            </div>
                                        </div>
                                        <div class="col-lg-12">
                                            <div class="billing-info mb-20">
                                                <label>Town / City</label>
                                                <input type="text">
                                            </div>
                                        </div>
                                        <div class="col-lg-6 col-md-6">
                                            <div class="billing-info mb-20">
                                                <label>State / County</label>
                                                <input type="text">
                                            </div>
                                        </div>
                                        <div class="col-lg-6 col-md-6">
                                            <div class="billing-info mb-20">
                                                <label>Postcode / ZIP</label>
                                                <input type="text">
                                            </div>
                                        </div>
                                        <div class="col-lg-6 col-md-6">
                                            <div class="billing-info mb-20">
                                                <label>Phone</label>
                                                <input type="text">
                                            </div>
                                        </div>
                                        <div class="col-lg-6 col-md-6">
                                            <div class="billing-info mb-20">
                                                <label>Email Address</label>
                                                <input type="text">
                                            </div>
                                        </div>
                                    </div>
                                </div> -->
                                <!-- <div class="additional-info-wrap">
                                    <label>Order notes</label>
                                    <textarea placeholder="Notes about your order, e.g. special notes for delivery. " name="message"></textarea>
                                </div> -->
                            </div>
                        </div>
                           
                        <div class="col-lg-5">
                            <div class="your-order-area">
                                <h3>Your order</h3>
                                <div class="your-order-wrap gray-bg-4">
                                    <div class="your-order-info-wrap">
                                        <div class="your-order-info">
                                            <ul>
                                                <!-- <li>a<span>Total</span></li> -->
                                            </ul>
                                        </div>
                                        <!-- <div class="your-order-middle">
                                            <ul>
                                                <li>Product Name X 1 <span>$329 </span></li>
                                                <li>Product Name X 1 <span>$329 </span></li>
                                            </ul>
                                        </div> -->
                                         <!-- <div class="your-order-info order-subtotal"> 
                                            <ul>
                                                <li>Subtotal <span><%= //totalPrice %> </span></li>
                                            </ul>
                                        </div>  -->
                                     
                                        <% 
                                      
                                        let totalPrice = 0;
                                        let totalDiscount = 0
                                        for(let i=0; i<cart.length; i++){
                                            totalPrice += cart[i].productId.price*cart[i].quantity
                                            if(cart[i].productId.offerPrice){
                                                totalDiscount += (cart[i].productId.price - cart[i].productId.offerPrice)*cart[i].quantity
                                            }else{
                                                totalDiscount += 0
                                            }
                                        }
                                        %>
                                        <div class="your-order-info order-subtotal"> 
                                            <ul>
                                                <li>Subtotal <span><%= totalPrice %> </span></li>
                                            </ul>
                                        </div> 
                                        <div class="your-order-info order-subtotal"> 
                                            <ul>
                                                <li>Offer Discount <span><%=totalDiscount %> </span></li>
                                            </ul>
                                        </div> 
                                        <div class="your-order-info order-subtotal"  id="couponDiscountDiv" hidden> 
                                            <ul>
                                                <li>Coupon Discount <span id="couponDiscount"> <%=Math.round(totalDiscount)%> </span></li>
                                            </ul>
                                            <span style="color: rgb(164, 0, 0);">
                                                
                                                <a href="" onclick="removeCoupon()">remove</a>
                                            </span>
                                        </div> 
                                       
                                        <div class="your-order-info order-total">
                                          
                                                <%console.log(totalDiscount+'dad')%>
                                                <% 
                                                let payAmount = totalPrice-totalDiscount
                                                %>
                                            <ul>
                                                <li>Total <span id="payAmount"><%=payAmount%> </span></li>
                                                <ul>
                                               
                                            
                                            
                                        </div>
                                    </div>
                                    <div class="payment-method">
                                        <div class="pay-top sin-payment">
                                            <input id="COD" class="" type="radio" value="COD" name="payment" checked>
                                            <label for="payment">Cash on delivery </label>
                                            <input id="Razorpay" class="" type="radio" value="Razorpay" name="payment" checked>
                                            <label for="payment"> Razorpay</label>



                                            <% 
                                        if(walletBalance> 0){
                                            %>
                                            <div id="walletCheckBoxDiv" <% if(walletBalance <=0){ %> hidden <% } %>>
                                                <input id="wallet" class="" type="radio" value="WALLET" name="payment" checked>
                                                <label for="payment">wallet</label>
                                                    <strong>
                                                        Use wallet Balance <span> &#8377; <%= walletBalance %> </span>
                                                    </strong>
                                                </label>
                                            </div>
                                            <%  
                                        }
                                        %>
  
                                        <!-- <div class="payment-box payment_method_bacs">
                                        <p>Make your payment directly into our bank account. Please use your Order ID as the payment reference.</p>
                                        </div> -->
                                        </div>
                                        </div>
                                 
                                </div>
                                <div style="display: flex; justify-content: center;">
                                    <button   style="    background-color: #000000;
                                               color: #fff;
                                               display: block;
                                               font-size: 14px;
                                               font-weight: 600;
                                               line-height: 1;
                                               padding: 18px 43px 17px;
                                               text-align: center;
                                               text-transform: capitalize;
                                               letter-spacing: .3px;
                                    margin-top: 40px;"  type="submit"class="btn "   <% if(!userAddress){  %> disabled <%  } %>>Place Order</button>
                                    <% if(!userAddress){  %> <p style="color: red;">Add address to place order</p> <%  } %>
                                </div>
                              
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </form>
        </div>




        <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-scrollable">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="exampleModalLabel">Coupons</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
        <div class="modal-body" style="height: 70vh; overflow-y: auto;">
            <% 
            if(coupons && coupons.length){
                coupons.forEach(coupon => {
                    %>
                    <div class="card px-2 mb-4">
                        <div class="coupon bg-white rounded mb-3 d-flex justify-content-between border-1">

                            <div class="tengah  d-flex w-100 justify-content-start">
                                <div class="p-2">
                                    <% 
                                    if(coupon.usedUsers.includes(userId)){
                                        %>
                                        <span class="badge badge-danger my-1">Used</span>
                                        <%  
                                    }else{
                                        %>
                                        <span class="badge badge-success my-1">Not Used</span>
                                        <% 
                                    }
                                    %>
                                    <h4 class="lead my-1"><strong>
                                            <%=coupon.code %>
                                        </strong></h4>
                                    <p class="text-muted mb-0 my-1">
                                        <%= coupon.description %>
                                    </p>
                                </div>
                            </div>
                            <div class="d-flex align-items-center">
                                <div class="info m-3 mt-4">
                                    <!-- <form action="" class="applyCouponModal" method="post"> -->
                                        <!-- <input type="text" value="<%=// coupon.code  %>" name="code" > -->
                                            
                                        <a id="<%= coupon.code %>" class="btn btn-sm btn-outline-secondary btn-block" onclick="copyCoupon('<%= coupon.code  %>')">
                                            COPY
                                        </a>
                                    <!-- </form> -->

                                </div>
                            </div>
                        </div>

                    </div>
                    <%  
                })
            }else{
                %>
                <small>No Coupons Available</small>
                <%  
            }
            %>
        </div>
            </div>
            
        </div>
     
      
    </div>


      
        <footer class="footer-area bg-gray pb-30" style="    padding-top: 30px;">
            <div class="container">
                <div class="row">
                    <div class="col-lg-6 col-md-6">
                        <div class="contact-info-wrap">
                            <!-- <div class="footer-logo">
                                <a href="#"><img src="assets/images/logo/logo.png" alt="logo"></a>
                            </div> -->
                            <div class="logo">
                                <a href="index.html"><span style="color: red;
                                    font-size: 34px;
                                    font-weight: 500;">Game</span> <span style="font-size: 20px;
                                    font-weight: 400;">Gallery</span></a>
                            </div>
                            <div class="single-contact-info">
                                <span style="margin-top: 10px;">Our Location</span>
                                <p>869 General Village Apt. 645, Moorebury, USA</p>
                            </div>
                            <div class="single-contact-info">
                                <span>24/7 hotline:</span>
                                <p>(+99) 052 128 2399</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-6 col-md-6">
                        <div class="footer-right-wrap">
                            <!-- <div class="footer-menu">
                                <nav>
                                    <ul>
                                        <li><a href="index.html">home</a></li>
                                        <li><a href="shop.html">Shop</a></li>
                                        <li><a href="shop.html">Product </a></li>
                                        <li><a href="contact.html">Contact</a></li>
                                        <li><a href="blog.html">Blog.</a></li>
                                    </ul>
                                </nav>
                            </div> -->
                            <div class="social-style-2 social-style-2-mrg">
                                <a href="#"><i class="social_twitter"></i></a>
                                <a href="#"><i class="social_facebook"></i></a>
                                <a href="#"><i class="social_googleplus"></i></a>
                                <a href="#"><i class="social_instagram"></i></a>
                                <a href="#"><i class="social_youtube"></i></a>
                            </div>
                            <div class="copyright">
                                <p>Copyright © 2021 HasThemes | <a href="https://hasthemes.com/">Built with <span>Norda</span> by HasThemes</a>.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </footer>
    </div>


    









    <!-- All JS is here
============================================ -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
        integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"
        integrity="sha384-fbbOQedDUMZZ5KreZpsbe1LCZPVmfTnH7ois6mU1QK+m14rQ1l2bGBq41eYeM/fS"
        crossorigin="anonymous"></script>
   
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <script>
        $('#checkout-form').submit((e) => {
            e.preventDefault()
            $.ajax({
                url:'/shoppingCart/placeOrder',
                method: 'post',
                data: $('#checkout-form').serialize(),
                success: (res) => {
                   // console.log(res);
                    if(res.status == 'COD'){
                        location.href = '/orderSuccess?result=success'
                    }else if(res.status == 'WALLET'){
                        location.href = '/orderSuccess?result=success'
                    }else if(res.status == 'Razorpay'){
                    razorpayPayment(res.order)
                }
                }
            });
        });


        function razorpayPayment(order){
        var options = {
            "key": "rzp_test_t2talviF4rgorS", // Enter the Key ID generated from the Dashboard
            "amount": order.amount, // Amount is in currency subunits. Default currency is INR. Hence, 50000 refers to 50000 paise
            "currency": "INR",
            "name": "Game Gallery",
            "description": "Test Transaction",
            "image": "https://example.com/your_logo",
            "order_id": order.id, //This is a sample Order ID. Pass the `id` obtained in the response of Step 1
            "handler": function (response){
              //  console.log(response,order);
                verifyPayment(response,order)
            },
            "prefill": {
                "name": "Gaurav Kumar",
                "email": "gaurav.kumar@example.com",
                "contact": "9000090000"
            },
            "notes": {
                "address": "Gents Garage Pvt Ltd"
            },
            "theme": {
                "color": "#3399cc"
            }
        };
       
        var rzpl = new Razorpay(options)
        rzpl.open()
    }

function verifyPayment(response,order){
    // console.log(response,order);
    // console.log('in verify payment function in checkout');
    $.ajax({
        url:'/verifyPayment',
        method:'post',
        data:{
            response,
            order
        },
        success:(res) => {
           // console.log(res);
            if(res.status == true){
                location.href = '/orderSuccess?result=success'
            }else{
                location.href = '/orderSuccess?result=failed'
            }
        }
    });
}
        

        </script>
        <script>
    $('#applyCoupon').submit((e) => {
        e.preventDefault()
//console.log('applyCoupon');    



$.ajax({
            url:'/applyCoupon',
            method: 'post',
            data: $('#applyCoupon').serialize(),   //$(this).serialize(),
            success: (res) => {
              //  console.log(res.message);
                if( res.status === true ){
                    $('#couponDiscount').html(`-₹ ${res.couponDiscount}`)
                    $('#payAmount').html(`₹ ${res.payAmount}`)
                    document.getElementById('couponDiscountDiv').hidden = false
                    document.getElementById('couponDiscountLabelDiv').hidden = false
                    $('#coupon-error').html('')
                 //   console.log();

                    const walletCheckBoxDiv = document.getElementById('walletCheckBoxDiv')
                    const walletCheckBox = document.getElementById('walletCheckBox')
                    const razorpayRadio = document.getElementById('Razorpay')
                    const COD = document.getElementById('COD')

                    if(res.isWalletHasPayAmount){
                        walletCheckBoxDiv.hidden = false;
                        walletCheckBox.hidden = true;
                    }
                }else{
                    $('#coupon-error').html(res.message)

                }
            }
        })
    })
</script>

<script>
    function removeCoupon() {
        $.ajax({
            url: '/removeCoupon',
            method: 'get',
            success: (res) => {
                if (res.status == true) {
                    location.reload()
                }
            }
        })
    }
</script>
<script>
    function copyCoupon(couponName) {
        document.getElementById(couponName).innerHTML = "COPIED"
        navigator.clipboard.writeText(couponName);
    }
</script>

</body>

</html>